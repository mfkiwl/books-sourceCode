function [ke, rq] = BVPRect8Element(kx, ky, p, q, coord)
% [ke, rq] = BVPRect8Element(kx, ky, p, q, coord)
% 8 node rectangular element for 2d BVP
% kx, ky, p, q = parameters defining the BVP
% coord = coordinates at the element ends

x1=coord(1,1); y1=coord(1,2);
x3=coord(3,1); y7=coord(7,2);
a = abs(x3 - x1)/2; b = abs(y7 - y1)/2;
kk = [(26*b*kx)/(45*a) + (26*a*ky)/(45*b), ...
        (-8*b*kx)/(9*a) + (a*ky)/(15*b), ...
        (14*b*kx)/(45*a) + (17*a*ky)/(90*b), ...
        -(b*kx)/(15*a) - (4*a*ky)/(9*b), ...
        (23*b*kx)/(90*a) + (23*a*ky)/(90*b), ...
        (-4*b*kx)/(9*a) - (a*ky)/(15*b), ...
        (17*b*kx)/(90*a) + (14*a*ky)/(45*b), ...
        (b*kx)/(15*a) - (8*a*ky)/(9*b);
    (-8*b*kx)/(9*a) + (a*ky)/(15*b), ...
        (16*b*kx)/(9*a) + (8*a*ky)/(15*b), ...
        (-8*b*kx)/(9*a) + (a*ky)/(15*b), 0, ...
        (-4*b*kx)/(9*a) - (a*ky)/(15*b), ...
        (8*b*kx)/(9*a) - (8*a*ky)/(15*b), ...
        (-4*b*kx)/(9*a) - (a*ky)/(15*b), 0;
    (14*b*kx)/(45*a) + (17*a*ky)/(90*b),...
        (-8*b*kx)/(9*a) + (a*ky)/(15*b), ...
        (26*b*kx)/(45*a) + (26*a*ky)/(45*b), ...
        (b*kx)/(15*a) - (8*a*ky)/(9*b), ...
        (17*b*kx)/(90*a) + (14*a*ky)/(45*b),...
        (-4*b*kx)/(9*a) - (a*ky)/(15*b), ...
        (23*b*kx)/(90*a) + (23*a*ky)/(90*b),...
        -(b*kx)/(15*a) - (4*a*ky)/(9*b);
    -(b*kx)/(15*a) - (4*a*ky)/(9*b), 0, ...
        (b*kx)/(15*a) - (8*a*ky)/(9*b), ...
        (8*b*kx)/(15*a) + (16*a*ky)/(9*b),...
        (b*kx)/(15*a) - (8*a*ky)/(9*b), 0,...
        -(b*kx)/(15*a) - (4*a*ky)/(9*b), ...
        (-8*b*kx)/(15*a) + (8*a*ky)/(9*b);
    (23*b*kx)/(90*a) + (23*a*ky)/(90*b),...
        (-4*b*kx)/(9*a) - (a*ky)/(15*b),...
        (17*b*kx)/(90*a) + (14*a*ky)/(45*b),...
        (b*kx)/(15*a) - (8*a*ky)/(9*b), ...
        (26*b*kx)/(45*a) + (26*a*ky)/(45*b),...
        (-8*b*kx)/(9*a) + (a*ky)/(15*b),...
        (14*b*kx)/(45*a) + (17*a*ky)/(90*b),...
        -(b*kx)/(15*a) - (4*a*ky)/(9*b);
    (-4*b*kx)/(9*a) - (a*ky)/(15*b), ...
        (8*b*kx)/(9*a) - (8*a*ky)/(15*b),...
        (-4*b*kx)/(9*a) - (a*ky)/(15*b), 0, ...
        (-8*b*kx)/(9*a) + (a*ky)/(15*b), ...
        (16*b*kx)/(9*a) + (8*a*ky)/(15*b), ...
        (-8*b*kx)/(9*a) + (a*ky)/(15*b), 0;
    (17*b*kx)/(90*a) + (14*a*ky)/(45*b),...
        (-4*b*kx)/(9*a) - (a*ky)/(15*b),...
        (23*b*kx)/(90*a) + (23*a*ky)/(90*b),...
        -(b*kx)/(15*a) - (4*a*ky)/(9*b),...
        (14*b*kx)/(45*a) + (17*a*ky)/(90*b),...
        (-8*b*kx)/(9*a) + (a*ky)/(15*b),...
        (26*b*kx)/(45*a) + (26*a*ky)/(45*b), ...
        (b*kx)/(15*a) - (8*a*ky)/(9*b);
    (b*kx)/(15*a) - (8*a*ky)/(9*b), 0, ...
        -(b*kx)/(15*a) - (4*a*ky)/(9*b),...
        (-8*b*kx)/(15*a) + (8*a*ky)/(9*b),...
        -(b*kx)/(15*a) - (4*a*ky)/(9*b), 0,...
        (b*kx)/(15*a) - (8*a*ky)/(9*b), (8*b*kx)/(15*a) + (16*a*ky)/(9*b)];
kp = [(-(2/15))*a*b*p, (2*a*b*p)/15, (-(2/45))*a*b*p, (8*a*b*p)/45,...
        (-(1/15))*a*b*p, (8*a*b*p)/45, (-(2/45))*a*b*p, (2*a*b*p)/15;
    (2*a*b*p)/15, (-(32/45))*a*b*p, (2*a*b*p)/15, (-(4/9))*a*b*p,...
        (8*a*b*p)/45, (-(16/45))*a*b*p, (8*a*b*p)/45, (-(4/9))*a*b*p;
    (-(2/45))*a*b*p, (2*a*b*p)/15, (-(2/15))*a*b*p, (2*a*b*p)/15, ...
        (-(2/45))*a*b*p, (8*a*b*p)/45, (-(1/15))*a*b*p, (8*a*b*p)/45;
    (8*a*b*p)/45, (-(4/9))*a*b*p, (2*a*b*p)/15, (-(32/45))*a*b*p,...
        (2*a*b*p)/15, (-(4/9))*a*b*p, (8*a*b*p)/45, (-(16/45))*a*b*p;
    (-(1/15))*a*b*p, (8*a*b*p)/45, (-(2/45))*a*b*p, (2*a*b*p)/15,...
        (-(2/15))*a*b*p, (2*a*b*p)/15, (-(2/45))*a*b*p, (8*a*b*p)/45;
    (8*a*b*p)/45, (-(16/45))*a*b*p, (8*a*b*p)/45, (-(4/9))*a*b*p,...
        (2*a*b*p)/15, (-(32/45))*a*b*p, (2*a*b*p)/15, (-(4/9))*a*b*p;
    (-(2/45))*a*b*p, (8*a*b*p)/45, (-(1/15))*a*b*p, (8*a*b*p)/45,...
        (-(2/45))*a*b*p, (2*a*b*p)/15, (-(2/15))*a*b*p, (2*a*b*p)/15;
    (2*a*b*p)/15, (-(4/9))*a*b*p, (8*a*b*p)/45, (-(16/45))*a*b*p, ...
        (8*a*b*p)/45, (-(4/9))*a*b*p, (2*a*b*p)/15, (-(32/45))*a*b*p];
ke = kk + kp; 
rq = [(-(1/3))*a*b*q; (4*a*b*q)/3; (-(1/3))*a*b*q;
    (4*a*b*q)/3; (-(1/3))*a*b*q; (4*a*b*q)/3;
    (-(1/3))*a*b*q; (4*a*b*q)/3];
